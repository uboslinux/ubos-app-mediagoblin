{
    "type" : "app",

    "roles" : {
        "apache2" : {
            "fixedcontext" : "",
            "depends" : [
                "mod_wsgi2"
            ],
            "apache2modules" : [
                "wsgi"
            ],
            "appconfigitems" : [
                {
                    "type"  : "directory",
                    "name"  : "${appconfig.datadir}",
                    "uname" : "${apache2.uname}",
                    "gname" : "${apache2.gname}"
                },
                {
                    "type"  : "directory",
                    "name"  : "${appconfig.datadir}/media",
                    "uname" : "${apache2.uname}",
                    "gname" : "${apache2.gname}"
                },
                {
                    "type"  : "directory",
                    "name"  : "${appconfig.datadir}/public",
                    "uname" : "${apache2.uname}",
                    "gname" : "${apache2.gname}"
                },
                {
                    "type"  : "directory",
                    "names"  : [
                        "/var/cache/${appconfig.appconfigid}",
                        "/var/cache/${appconfig.appconfigid}/egg-cache",
                    ],
                    "uname" : "${apache2.uname}",
                    "gname" : "${apache2.gname}"
                },
                {
                    "type"         : "file",
                    "name"         : "${appconfig.apache2.dir}/wsgi.py",
                    "template"     : "tmpl/wsgi.py.tmpl",
                    "templatelang" : "varsubst"
                },
                {
                    "type"         : "file",
                    "name"         : "${appconfig.datadir}/paste.ini",
                    "template"     : "tmpl/paste.ini.tmpl",
                    "templatelang" : "varsubst"
                },
                {
                    "type"         : "file",
                    "name"         : "${appconfig.datadir}/mediagoblin.ini",
                    "template"     : "tmpl/mediagoblin.ini.tmpl",
                    "templatelang" : "varsubst"
                },
                {
                    "type"         : "file",
                    "name"         : "${appconfig.apache2.appconfigfragmentfile}",
                    "template"     : "tmpl/htaccess.tmpl",
                    "templatelang" : "varsubst"
                }
            ],
            "installers" : [
                {
                    "type"   : "perlscript",
                    "source" : "bin/init.pl"
                }
            ],
            "upgraders" : [
                {
                    "type"   : "perlscript",
                    "source" : "bin/init.pl"
                },
            ]
        },
        "postgresql" : {
            "appconfigitems" : [
                {
                    "type"       : "postgresql-database",
                    "name"       : "maindb",
                    "retentionpolicy"  : "keep",
                    "retentionbucket"  : "maindb",
                    "privileges" : "all privileges"
                }
            ]
        }
    }
}
